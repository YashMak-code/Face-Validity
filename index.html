<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¿ƒç¥ä¸å®ï¼šæ„å¿µåˆ†ç±»ä»»åŠ¡</title>
    <style>
        :root {
            --primary: #4a90e2;
            --selected: #ff9f43;
            --bg: #f0f2f5;
            --card-bg: #ffffff;
            --text: #333;
            --border: #dcdfe6;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 10px;
            padding-bottom: 50px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: var(--card-bg);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            min-height: 90vh;
            display: flex;
            flex-direction: column;
        }

        h1 { font-size: 1.5rem; text-align: center; color: var(--primary); margin-bottom: 10px; }
        p { line-height: 1.6; color: #555; }

        .step { display: none; flex: 1; flex-direction: column; }
        .step.active { display: flex; }

        /* æŒ‰é’®é€šç”¨æ ·å¼ */
        .btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 12px 0;
            width: 100%;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            margin-top: 20px;
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
        }
        .btn:active { opacity: 0.9; transform: scale(0.98); }
        .btn-copy { background-color: #27ae60; margin-bottom: 10px; }

        /* é˜¶æ®µ 1ï¼šè¾“å…¥ */
        .input-group { display: flex; gap: 10px; margin-bottom: 15px; }
        .input-box { flex: 1; padding: 10px; border: 1px solid var(--border); border-radius: 6px; font-size: 16px; }
        .tag-container { display: flex; flex-wrap: wrap; gap: 8px; padding: 10px; border: 2px dashed var(--border); border-radius: 8px; min-height: 80px; align-content: flex-start; }
        .tag { background: #e3f2fd; color: var(--primary); padding: 5px 10px; border-radius: 15px; font-size: 14px; display: flex; align-items: center; }
        .tag span { margin-left: 6px; font-weight: bold; padding: 0 4px; }

        /* é˜¶æ®µ 3ï¼šåˆ†ç±»æ ¸å¿ƒæ ·å¼ (æ‰‹æœºé€‚é…) */
        .sorting-area { display: flex; flex-direction: column; height: 100%; }

        /* é¡¶éƒ¨å›ºå®šå¾…åˆ†ç±»å¡ç‰‡åŒº */
        .deck-container {
            position: sticky;
            top: 0;
            background: var(--bg);
            z-index: 100;
            padding: 10px 0;
            border-bottom: 1px solid #ddd;
            margin-bottom: 10px;
            text-align: center;
        }

        .current-card {
            background: white;
            border: 2px solid var(--primary);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(74, 144, 226, 0.2);
            font-size: 16px;
            font-weight: 500;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            cursor: pointer;
        }
        .current-card.selected {
            background-color: #fff8e1;
            border-color: var(--selected);
            transform: scale(1.02);
            box-shadow: 0 0 15px rgba(255, 159, 67, 0.4);
        }
        .instruction-tip { font-size: 12px; color: #999; margin-top: 5px; }

        /* åº•éƒ¨æ¡¶åŒº */
        .buckets-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            padding-bottom: 20px;
            flex: 1;
        }

        .bucket {
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 10px 5px;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            transition: background 0.2s;
            position: relative;
        }
        .bucket:active { background-color: #f0f0f0; }
        .bucket h4 { margin: 0; font-size: 14px; color: #333; text-align: center; pointer-events: none; }
        .bucket p { font-size: 10px; color: #888; margin: 2px 0 5px 0; text-align: center; pointer-events: none;}
        .bucket-count {
            background: var(--primary); color: white; border-radius: 10px;
            padding: 2px 8px; font-size: 10px; margin-top: auto;
        }

        /* ç»“æœé¡µ */
        .json-box { width: 100%; height: 150px; border: 1px solid #ccc; font-size: 12px; padding: 5px; box-sizing: border-box; }

        /* ç®€å•çš„è¿›åº¦æ¡ */
        .progress-bar { height: 4px; background: #eee; width: 100%; margin-bottom: 15px; }
        .progress-fill { height: 100%; background: var(--primary); width: 25%; transition: width 0.3s; }

    </style>
</head>
<body>

<div class="container">
    <div class="progress-bar"><div class="progress-fill" id="progress"></div></div>

    <div id="step1" class="step active">
        <h1>é˜¶æ®µä¸€ï¼šç›´è§‰è”æƒ³</h1>
        <p>æåˆ° <strong>â€œå¿ƒç¥ä¸å®â€</strong>ï¼Œä½ è„‘æµ·ä¸­ç¬¬ä¸€ååº”ä¼šå‡ºç°å“ªäº›ç—‡çŠ¶æˆ–æ„Ÿå—ï¼Ÿ</p>

        <div class="input-group">
            <input type="text" id="wordInput" class="input-box" placeholder="å¦‚ï¼šå¿ƒæ…Œã€ä¹±æƒ³...">
            <button style="width: auto; margin:0; padding: 0 20px;" class="btn" onclick="addTag()">æ·»åŠ </button>
        </div>

        <div class="tag-container" id="tagCloud"></div>
        <button class="btn" onclick="nextStep(2)">ä¸‹ä¸€æ­¥</button>
    </div>

    <div id="step2" class="step">
        <h1>é˜¶æ®µäºŒï¼šç»´åº¦æ¦‚è§ˆ</h1>
        <p>æˆ‘ä»¬å°†â€œå¿ƒç¥ä¸å®â€åˆ†ä¸ºäº†ä»¥ä¸‹ 5 ä¸ªæ–¹é¢ï¼Œè¯·æ‚¨å¿«é€Ÿæµè§ˆï¼š</p>
        <ul style="padding-left: 20px; font-size: 14px; color: #444;">
            <li><strong>â‘  æƒ…ç»ªçƒ¦èºï¼š</strong>æ˜“æ€’ã€åç«‹éš¾å®‰</li>
            <li><strong>â‘¡ åå¤æ€è™‘ï¼š</strong>è„‘å­åœä¸ä¸‹æ¥ã€çº ç»“</li>
            <li><strong>â‘¢ æ³¨æ„æ¶£æ•£ï¼š</strong>èµ°ç¥ã€éš¾ä»¥é›†ä¸­</li>
            <li><strong>â‘£ ç¡çœ å›°æ‰°ï¼š</strong>å…¥ç¡éš¾ã€å¤šæ¢¦æ—©é†’</li>
            <li><strong>â‘¤ æƒŠæƒ•ç´§å¼ ï¼š</strong>æ˜“å—æƒŠã€å¿ƒæ…Œèƒ¸é—·</li>
        </ul>
        <textarea id="dimensionComment" style="width:100%; padding:10px; box-sizing:border-box; border-radius:6px; border:1px solid #ccc;" placeholder="å¦‚æœ‰é—æ¼çš„é‡è¦æ–¹é¢ï¼Œè¯·åœ¨æ­¤è¡¥å……..."></textarea>
        <button class="btn" onclick="nextStep(3)">æˆ‘å·²äº†è§£ï¼Œå¼€å§‹åˆ†ç±»</button>
    </div>

    <div id="step3" class="step">
        <h1>é˜¶æ®µä¸‰ï¼šæ¡ç›®å½’ç±»</h1>

        <div class="deck-container">
            <div id="cardDisplay" class="current-card selected" onclick="shakeCard()">
                </div>
            <div class="instruction-tip">ğŸ‘† ç‚¹å‡»ä¸‹æ–¹åˆ†ç±»æ¡†ï¼Œå°†ä¸Šé¢è¿™å¼ å¡ç‰‡å½’ç±»</div>
        </div>

        <div class="buckets-grid">
            <div class="bucket" onclick="placeCard('E')">
                <h4>æƒ…ç»ªçƒ¦èº</h4><p>æ˜“æ€’/éš¾å®‰</p>
                <span class="bucket-count" id="count-E">0</span>
            </div>
            <div class="bucket" onclick="placeCard('R')">
                <h4>åå¤æ€è™‘</h4><p>çº ç»“/åœä¸ä¸‹</p>
                <span class="bucket-count" id="count-R">0</span>
            </div>
            <div class="bucket" onclick="placeCard('A')">
                <h4>æ³¨æ„æ¶£æ•£</h4><p>èµ°ç¥/åˆ†å¿ƒ</p>
                <span class="bucket-count" id="count-A">0</span>
            </div>
            <div class="bucket" onclick="placeCard('SD')">
                <h4>ç¡çœ å›°æ‰°</h4><p>å¤±çœ /å¤šæ¢¦</p>
                <span class="bucket-count" id="count-SD">0</span>
            </div>
            <div class="bucket" onclick="placeCard('SH')">
                <h4>æƒŠæƒ•ç´§å¼ </h4><p>å¿ƒæ…Œ/æ˜“æƒŠ</p>
                <span class="bucket-count" id="count-SH">0</span>
            </div>
            <div class="bucket" style="background:#fff0f0; border-color:#ffcccc;" onclick="placeCard('Trash')">
                <h4 style="color:#c0392b">ä¸ç¡®å®š/åƒåœ¾æ¡¶</h4>
                <span class="bucket-count" style="background:#e74c3c" id="count-Trash">0</span>
            </div>
        </div>
    </div>

    <div id="step4" class="step">
        <h1>âœ… å®Œæˆï¼</h1>
        <p>æ„Ÿè°¢æ‚¨çš„å¸®åŠ©ã€‚è¯·ç‚¹å‡»ä¸‹æ–¹ç»¿è‰²æŒ‰é’®å¤åˆ¶æ•°æ®ï¼Œå‘é€ç»™ç ”ç©¶è€…ã€‚</p>

        <button class="btn btn-copy" onclick="copyToClipboard()">ğŸ“‹ ä¸€é”®å¤åˆ¶ç»“æœ</button>
        <button class="btn btn-outline" style="background:#fff; color:#666; border:1px solid #ccc; font-weight:normal;" onclick="downloadData()">å¤‡ç”¨ï¼šä¸‹è½½æ–‡ä»¶</button>

        <p style="font-size: 12px; margin-top: 10px;">æ•°æ®é¢„è§ˆï¼š</p>
        <textarea class="json-box" id="resultOutput" readonly></textarea>
    </div>
</div>

<script>
    // æ‚¨çš„ 25 ä¸ªç²¾é€‰æ¡ç›® (å·²æ›´æ–°ä¸º 5 ç»´ç»“æ„)
    const rawItems = [
        { id: "E1", content: "æˆ‘å¸¸å¸¸æ„Ÿåˆ°è«åå…¶å¦™çš„çƒ¦èºï¼Œçœ‹ä»€ä¹ˆéƒ½ä¸é¡ºçœ¼ã€‚", target: "E" },
        { id: "E2", content: "æˆ‘æ¯”å¹³æ—¶æ›´å®¹æ˜“å› ä¸ºå°äº‹ç”Ÿæ°”ã€‚", target: "E" },
        { id: "E3", content: "æˆ‘ç»å¸¸æ„Ÿåˆ°ç´§å¼ ï¼Œå¥½åƒæ€»æœ‰ä¸å¥½çš„äº‹æƒ…è¦å‘ç”Ÿã€‚", target: "E" },
        { id: "E4", content: "å³ä½¿å‘¨å›´æ²¡æœ‰ä»€ä¹ˆå¤§äº‹ï¼Œæˆ‘ä¹Ÿæ„Ÿåˆ°åç«‹éš¾å®‰ï¼Œæ— æ³•æ”¾æ¾ã€‚", target: "E" },
        { id: "E6", content: "ä¸€æ—¦ç¯å¢ƒæˆ–è®¡åˆ’æœ‰ä¸€ç‚¹å˜åŒ–ï¼Œæˆ‘å°±ä¼šæ„Ÿåˆ°çƒ¦èºã€‚", target: "E" },
        { id: "E9", content: "æˆ‘å¯¹å‘¨å›´çš„å£°éŸ³æˆ–å¹²æ‰°æ„Ÿåˆ°ç‰¹åˆ«ä¸è€çƒ¦ã€‚", target: "E" },

        { id: "C1", content: "æˆ‘å¸¸å¸¸æ­¢ä¸ä½åœ°åå¤æƒ³ç€åŒä¸€ä»¶çƒ¦å¿ƒäº‹ã€‚", target: "R" },
        { id: "C4", content: "å³ä½¿æˆ‘æƒ³åœæ­¢æ€è€ƒæŸäº›äº‹ï¼Œè„‘å­è¿˜æ˜¯ä¼šä¸ç”±è‡ªä¸»åœ°ç»§ç»­è½¬åŠ¨ã€‚", target: "R" },
        { id: "C5", content: "æˆ‘ç»å¸¸ä¸€éåˆä¸€éåœ°å›æƒ³è‡ªå·±è¿‡å»åšé”™æˆ–æ²¡åšå¥½çš„äº‹ã€‚", target: "R" },
        { id: "C7", content: "åšå†³å®šæ—¶ï¼Œæˆ‘å¸¸å¸¸åœ¨å¿ƒé‡Œæ¥å›æƒè¡¡å¾ˆä¹…ï¼ŒçŠ¹è±«ä¸å†³ã€‚", target: "R" },
        { id: "C8", content: "æˆ‘æ„Ÿè§‰è„‘å­ä¹±ä¹±çš„ï¼Œåƒä¸€å›¢æµ†ç³Šï¼Œç†ä¸æ¸…å¤´ç»ªã€‚", target: "R" },

        { id: "A2", content: "å³ä½¿åœ¨åšäº‹æƒ…æ—¶ï¼Œæˆ‘çš„å¿ƒæ€ä¹Ÿæ€»æ˜¯é£˜åˆ°åˆ«çš„äº‹æƒ…ä¸Šã€‚", target: "A" },
        { id: "A3", content: "æˆ‘å¾ˆéš¾æŠŠæ³¨æ„åŠ›æŒç»­åœ°é›†ä¸­åœ¨æ‰‹å¤´çš„ä»»åŠ¡ä¸Šã€‚", target: "A" },
        { id: "A1", content: "æˆ‘å‘ç°è‡ªå·±å‘å‘†ã€ææƒšçš„æ—¶é—´æ¯”ä»¥å‰å¤šäº†ã€‚", target: "A" },
        { id: "A4", content: "æˆ‘æ„Ÿè§‰è®°å¿†åŠ›å¥½åƒå˜å·®äº†ï¼Œåˆšåšçš„äº‹è½¬å¤´å°±å¿˜ã€‚", target: "A" },

        { id: "S1", content: "æˆ‘å…¥ç¡å›°éš¾ï¼Œèººåœ¨åºŠä¸Šéœ€è¦å¾ˆé•¿æ—¶é—´æ‰èƒ½ç¡ç€ã€‚", target: "SD" },
        { id: "S2", content: "æˆ‘ç¡çœ å¾ˆæµ…ï¼Œæˆ–è€…å¤šæ¢¦ï¼Œå¤œé‡Œå®¹æ˜“é†’æ¥ã€‚", target: "SD" },
        { id: "S3", content: "æˆ‘ä¼šæ¯”é¢„æœŸæ›´æ—©é†’æ¥ï¼Œä¹‹åå¾ˆéš¾å†ç¡ç€ã€‚", target: "SD" },
        { id: "S9", content: "æˆ‘ç¡è§‰æ—¶æ€»è§‰å¾—è„‘å­é‡Œåƒåœ¨â€œæ”¾ç”µå½±â€ï¼Œå¯¼è‡´æ— æ³•å…¥ç¡ã€‚", target: "SD" },

        { id: "S5", content: "åœ¨æ²¡æœ‰å‰§çƒˆè¿åŠ¨çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä¹Ÿèƒ½æ„Ÿè§‰åˆ°å¿ƒè·³åŠ å¿«æˆ–å¿ƒæ…Œã€‚", target: "SH" },
        { id: "S6", content: "æˆ‘å®¹æ˜“è¢«ä¸€äº›çªç„¶çš„å°å£°éŸ³æˆ–åŠ¨ä½œå“ä¸€è·³ã€‚", target: "SH" },
        { id: "S7", content: "å³ä½¿èº«ä½“å¾ˆç´¯ï¼Œæˆ‘ä»è§‰å¾—å¤§è„‘å¤„äºå…´å¥‹çŠ¶æ€ï¼Œåœä¸ä¸‹æ¥ã€‚", target: "SH" },
        { id: "S8", content: "æˆ‘æ„Ÿåˆ°èƒ¸é—·ï¼Œæˆ–è€…éœ€è¦åšæ·±å‘¼å¸æ‰èˆ’æœã€‚", target: "SH" }
    ];

    let userTags = [];
    let sortResults = [];
    let shuffledDeck = [];
    let bucketCounts = { E:0, R:0, A:0, SD:0, SH:0, Trash:0 };

    window.onload = function() {
        shuffledDeck = [...rawItems].sort(() => Math.random() - 0.5);
        updateProgress(1);
    };

    // --- é˜¶æ®µ 1 ---
    function addTag() {
        const input = document.getElementById("wordInput");
        if (input.value.trim()) {
            userTags.push(input.value.trim());
            renderTags();
            input.value = "";
            input.focus();
        }
    }
    function renderTags() {
        document.getElementById("tagCloud").innerHTML = userTags.map((t,i) =>
            `<div class="tag">${t}<span onclick="userTags.splice(${i},1);renderTags()">Ã—</span></div>`
        ).join("");
    }

    // --- é˜¶æ®µ 3 æ ¸å¿ƒäº¤äº’ ---
    function renderCard() {
        const cardDiv = document.getElementById("cardDisplay");
        if (shuffledDeck.length === 0) {
            nextStep(4);
            return;
        }
        const item = shuffledDeck[0];
        cardDiv.innerHTML = `<div style="text-align:center"><div style="font-size:12px;color:#999;margin-bottom:5px">å‰©ä½™ ${shuffledDeck.length} é¢˜</div>${item.content}</div>`;

        // ç®€å•çš„è¿›å…¥åŠ¨ç”»
        cardDiv.style.opacity = 0;
        cardDiv.style.transform = "scale(0.9)";
        setTimeout(() => {
            cardDiv.style.opacity = 1;
            cardDiv.style.transform = "scale(1)";
        }, 50);
    }

    function placeCard(bucketId) {
        if (shuffledDeck.length === 0) return;

        const currentItem = shuffledDeck[0];

        // è®°å½•æ•°æ®
        sortResults.push({
            id: currentItem.id,
            bucket: bucketId,
            correct: currentItem.target === bucketId
        });

        // æ›´æ–°è®¡æ•°UI
        bucketCounts[bucketId]++;
        document.getElementById(`count-${bucketId}`).innerText = bucketCounts[bucketId];

        // ç§»é™¤æ—§å¡ç‰‡
        shuffledDeck.shift();
        renderCard();
    }

    function shakeCard() {
        const card = document.getElementById("cardDisplay");
        card.style.transform = "translateX(5px)";
        setTimeout(() => card.style.transform = "translateX(-5px)", 50);
        setTimeout(() => card.style.transform = "translateX(0)", 100);
    }

    // --- å¯¼èˆªä¸ç»“æœ ---
    function nextStep(step) {
        document.querySelectorAll('.step').forEach(el => el.classList.remove('active'));
        document.getElementById(`step${step}`).classList.add('active');
        document.getElementById('progress').style.width = (step/4)*100 + "%";

        if (step === 3) renderCard();
        if (step === 4) generateResult();
    }

    function generateResult() {
        const data = {
            tags: userTags,
            comment: document.getElementById("dimensionComment").value,
            results: sortResults,
            accuracy: Math.round((sortResults.filter(r=>r.correct).length / sortResults.length)*100) + "%"
        };
        document.getElementById("resultOutput").value = JSON.stringify(data);
    }

    function copyToClipboard() {
        const copyText = document.getElementById("resultOutput");
        copyText.select();
        copyText.setSelectionRange(0, 99999);
        navigator.clipboard.writeText(copyText.value).then(() => {
            alert("å·²å¤åˆ¶ï¼è¯·å»å¾®ä¿¡ç²˜è´´ç»™åŒå­¦ã€‚");
        });
    }

    function downloadData() {
        const text = document.getElementById("resultOutput").value;
        const blob = new Blob([text], { type: "text/plain" });
        const a = document.createElement("a");
        a.href = URL.createObjectURL(blob);
        a.download = `Result_${new Date().getTime()}.txt`;
        a.click();
    }
</script>

</body>
</html>